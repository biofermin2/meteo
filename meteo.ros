#!/bin/sh
#|-*- mode:lisp -*-|#
#|
exec ros -Q -- $0 "$@"
|#
(progn ;;init forms
  (ros:ensure-asdf)
  #+quicklisp(ql:quickload '(:unio :dexador :jonathan :alexandria) :silent t)
  )					; => (:UNIO :DEXADOR :JONATHAN :ALEXANDRIA)

(defpackage :ros.script.meteo.3845973535
  (:use :cl :unio :dexador :jonathan :alexandria)
  (:shadow :delete :get))		; => #<PACKAGE "ROS.SCRIPT.METEO.3845973535">
(in-package :ros.script.meteo.3845973535) ; => #<PACKAGE "ROS.SCRIPT.METEO.3845973535">
(defconstant url "https://www.jma.go.jp/bosai/forecast/data/forecast/170000.json") ; => URL
(defparameter s-json (parse (dex:get url))) ; => S-JSON
(defvar weather)			    ; => WEATHER
(defvar noto)				    ; => NOTO
(defvar weathers)			    ; => WEATHERS
(defvar weather-code)			    ; => WEATHER-CODE

(sets weather (seek "weather" (format nil "~s" s-json))) ; => 
(setf noto (cadr weather))
(setf weathers (getf noto :|weathers|))
(setf weather-code (getf noto :|weatherCodes|))

(setf w-code-plist
      '(100 â˜¼ 101 â˜¼â˜ 102 â˜¼â˜” 104 â˜¼â˜ƒ 110 â˜¼â†’â˜ 111 â˜¼â†’â˜ 112 â˜¼â†’â˜” 115 â˜¼â†’â˜ƒ
	200 â˜ 201 â˜â˜¼ 202 â˜â˜” 204 â˜â˜ƒ 210 â˜â†’â˜¼
	300 â˜” 301 â˜”â˜¼ 302 â˜”â˜ 303 â˜”â˜ƒ
	400 â˜ƒ 401 â˜ƒâ˜¼ 402 â˜ƒâ˜ 403 â˜ƒâ˜”
	500 â˜†ğŸŒ™ 501 â˜†ğŸŒ™â˜ 502 â˜†ğŸŒ™â˜” 504 â˜†ğŸŒ™â˜ƒ 510 â˜†ğŸŒ™â†’â˜ 512 â˜†ğŸŒ™â†’â˜”
	601 â˜â­ğŸŒ™ 610 â˜â†’â­ğŸŒ™
	701 â˜”â­ğŸŒ™
	801 â˜ƒâ­ğŸŒ™))
(setf ht (plist-hash-table w-code-plist :test #'equal)) ; => #<HASH-TABLE :TEST EQUAL :COUNT 31 {100330BAF3}>

(defun code->sym (code)
    (if (stringp code)
            (gethash (parse-integer code) ht)
	          (gethash code ht))); => CODE->SYM


(defun main (&rest argv)
  (declare (ignorable argv))
  (format t "~{~s~}" (reverse (pairlis (mapcar #'code->sym weather-code) weathers))) 
  )					; => MAIN

;;; vim: set ft=lisp lisp:
